<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS Quân đội nhân dân Việt Nam (Cyberpunk)</title>
    
    <link rel="icon" type="image/png" href="/favicon.png"> 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.7.0/mammoth.browser.min.js"></script>

    <style>
        /* --- 1. CẤU HÌNH CHUNG --- */
        body {
            font-family: 'Chakra Petch', sans-serif; 
            margin: 0; display: flex;
            justify-content: center; align-items: center; min-height: 100vh;
            color: #00f7ff; 
            overflow-x: hidden; 
            background-color: #000;
            position: relative;
        }
        
        /* --- 2. HÌNH NỀN ĐỘNG --- */
        .cyberpunk-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
            background-color: #050510; 
        }

        .bg-image {
            width: 100%; height: 100%;
            object-fit: cover;
            position: absolute; top: 0; left: 0;
            opacity: 0.6;
        }

        .scanlines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,247,255,0) 50%, rgba(0,247,255,0.02) 50%);
            background-size: 100% 3px; z-index: 1; pointer-events: none;
        }
        .glitch-line {
            position: absolute; left: 0; width: 100%; height: 2px;
            background: linear-gradient(to right, transparent, #00f7ff, #ff00ff, transparent);
            opacity: 0.8; z-index: 2;
            box-shadow: 0 0 10px #00f7ff;
            animation: glitch-anim 4s infinite linear;
        }
        .glitch-line:nth-child(2) { animation-delay: 2s; height: 1px; opacity: 0.5; }

        @keyframes glitch-anim {
            0% { top: -10%; opacity: 0; }
            100% { top: 110%; opacity: 0; }
        }
        
        .vignette {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 40%, #000 100%);
            z-index: 3; pointer-events: none;
        }

        /* --- 3. MÀN HÌNH CHÀO (SPLASH SCREEN) --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; text-align: center;
            z-index: 1000; opacity: 1; transition: opacity 0.8s ease-out;
        }

        .splash-logo {
            width: 140px; height: 140px; margin-bottom: 30px;
            filter: drop-shadow(0 0 15px #00f7ff); 
            animation: pulse-logo 2s infinite ease-in-out;
        }
        @keyframes pulse-logo {
            0% { transform: scale(1); filter: drop-shadow(0 0 10px #00f7ff); }
            50% { transform: scale(1.05); filter: drop-shadow(0 0 25px #00f7ff); }
            100% { transform: scale(1); filter: drop-shadow(0 0 10px #00f7ff); }
        }

        #splash-screen h1 {
            font-size: 2.5em; font-weight: 700; margin: 10px 0;
            text-transform: uppercase; letter-spacing: 2px;
            color: #fff; text-shadow: 0 0 10px #00f7ff, 0 0 20px #00f7ff; 
        }
        #splash-screen p { font-size: 1.2em; color: #aaa; margin-bottom: 50px; letter-spacing: 1px; }
        #author-name { color: #ff00ff; font-weight: 700; text-shadow: 0 0 5px #ff00ff; } 

        #start-button {
            padding: 15px 60px; border: 2px solid #00f7ff; 
            background: rgba(0, 247, 255, 0.1); color: #00f7ff;
            font-family: 'Chakra Petch', sans-serif; font-size: 1.5em; font-weight: 700; 
            cursor: pointer; text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 0 15px rgba(0, 247, 255, 0.3); transition: 0.3s;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%); 
        }
        #start-button:hover { background: #00f7ff; color: #000; box-shadow: 0 0 40px #00f7ff; }

        /* --- 4. GIAO DIỆN CHÍNH (MAIN APP) --- */
        #main-app { display: none; width: 100%; width: 100%; min-height: 100vh; display: flex; justify-content: center; align-items: center; } 
        
        .logo-quan-doi-goc {
            position: fixed; top: 20px; left: 20px; width: 70px; height: auto; z-index: 100;
            filter: drop-shadow(0 0 5px #00f7ff); display: none; 
        }

        /* --- LỚP VỎ NGOÀI CHỨA ẢNH HUD LỚN --- */
        .hud-wrapper {
            background-image: url('/hud-frame.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            background-position: center;
            
            width: 95%; 
            max-width: 1200px; 
            min-height: 750px; 
            
            display: flex; justify-content: center; align-items: center;
            position: relative; z-index: 10;
            padding: 50px; 
            box-sizing: border-box;
        }

        /* --- CONTAINER NỘI DUNG BÊN TRONG --- */
        .container {
            background-color: rgba(10, 20, 30, 0.85); 
            padding: 30px; border-radius: 5px; 
            width: 100%; max-width: 600px; 
            border: 1px solid #00f7ff; 
            box-shadow: 0 0 20px rgba(0, 247, 255, 0.1), inset 0 0 20px rgba(0, 247, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        h2 { text-align: center; color: #00f7ff; margin-bottom: 25px; text-shadow: 0 0 10px rgba(0,247,255,0.5); }

        .tab-buttons { display: flex; margin-bottom: 20px; border-bottom: 1px solid rgba(0, 247, 255, 0.3); }
        .tab-button {
            flex: 1; padding: 12px; background: transparent; border: none;
            color: #555; font-family: 'Chakra Petch', sans-serif; font-weight: 700; font-size: 1.1em;
            cursor: pointer; transition: 0.3s;
        }
        .tab-button.active { color: #00f7ff; border-bottom: 2px solid #00f7ff; text-shadow: 0 0 5px #00f7ff; }
        
        .tab-content { display: none; width: 100%; }
        .tab-content.active { display: block; }

        textarea {
            width: 100%; height: 150px; padding: 15px; 
            background: rgba(0, 10, 20, 0.6); 
            border: 1px solid #004455; color: #00f7ff;
            font-family: 'Chakra Petch', sans-serif; resize: vertical; box-sizing: border-box;
            font-size: 16px; border-radius: 5px;
        }
        textarea:focus { outline: none; border-color: #00f7ff; box-shadow: 0 0 15px rgba(0,247,255,0.2); }

        #file-input { display: none; }
        .file-label {
            display: block; padding: 20px; text-align: center; border: 2px dashed #004455;
            background: rgba(0,247,255,0.05); color: #00f7ff; cursor: pointer; transition: 0.3s;
            font-size: 1.2em;
        }
        .file-label:hover { background: rgba(0,247,255,0.15); border-color: #00f7ff; }
        #file-name { text-align: center; color: #aaa; margin-top: 10px; font-style: italic; font-size: 1.1em; }

        .control-group { margin: 20px 0; }
        label { display: block; color: #00f7ff; margin-bottom: 10px; font-weight: 700; font-size: 1.1em; }
        
        select {
            width: 100%; padding: 12px; background: rgba(0, 10, 20, 0.8); border: 1px solid #004455;
            color: #00f7ff; font-family: 'Chakra Petch', sans-serif; outline: none; font-size: 16px; border-radius: 5px;
        }
        
        input[type="range"] { width: 100%; accent-color: #00f7ff; cursor: pointer; height: 8px; }

        #speak-btn {
            width: 100%; padding: 15px; border: 1px solid #00f7ff; background: rgba(0, 247, 255, 0.2);
            color: #00f7ff; font-family: 'Chakra Petch', sans-serif; font-weight: 700; font-size: 1.5em;
            cursor: pointer; transition: 0.3s; box-shadow: 0 0 15px rgba(0,247,255,0.3);
            text-transform: uppercase; margin-top: 20px; letter-spacing: 2px;
        }
        #speak-btn:hover { background: #00f7ff; color: #000; box-shadow: 0 0 30px #00f7ff; }
        #speak-btn:disabled { background: #333; color: #555; cursor: not-allowed; box-shadow: none; border-color: #555; }

        .status { text-align: center; color: #aaa; margin-top: 15px; min-height: 1.5em; font-size: 1.1em; }
        
        audio { width: 100%; margin-top: 20px; filter: invert(1) hue-rotate(180deg); height: 40px; }
        
        .download-button {
            display: block; width: 100%; text-align: center; padding: 12px;
            border: 1px solid #ff00ff; color: #ff00ff; text-decoration: none;
            margin-top: 15px; font-weight: 700; transition: 0.3s; box-sizing: border-box;
            background: rgba(255, 0, 255, 0.1); font-size: 1.2em;
        }
        .download-button:hover { background: #ff00ff; color: #000; box-shadow: 0 0 25px #ff00ff; }

        @media (max-width: 800px) {
            .hud-wrapper { background-image: none; padding: 20px; min-height: auto; }
            .container { width: 100%; border: 2px solid #00f7ff; }
            #splash-screen h1 { font-size: 1.8em; }
            .splash-logo { width: 100px; height: 100px; }
        }
    </style>
</head>
<body>

    <div class="cyberpunk-bg">
        <img src="/image_36.png" alt="BG" class="bg-image">
        <div class="scanlines"></div>
        <div class="glitch-line" style="top: 20%;"></div>
        <div class="glitch-line" style="top: 60%; animation-delay: 2s;"></div>
        <div class="vignette"></div>
    </div>

    <img src="/logo_quan_doi.png" alt="Logo" class="logo-quan-doi-goc" id="main-logo">

    <div id="splash-screen">
        <img src="/logo_thuyet_minh.png" alt="Logo Splash" class="splash-logo">
        <h1>PHẦN MỀM<br>HỖ TRỢ THUYẾT MINH</h1>
        <p>Tác giả: <span id="author-name">Đỗ Nhật Quang</span></p>
        <button id="start-button">BẮT ĐẦU</button>
    </div>

    <div id="main-app" style="display: none;">
        <div class="hud-wrapper">
            <div class="container">
                <h2>CHUYỂN ĐỔI VĂN BẢN</h2>
                
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="openTab(event, 'text-tab')">NHẬP VĂN BẢN</button>
                    <button class="tab-button" onclick="openTab(event, 'upload-tab')">TẢI FILE WORD</button>
                </div>

                <div id="text-tab" class="tab-content active">
                    <textarea id="text-input" placeholder="Kính mời quý Thủ trưởng cùng các đồng chí nhập văn bản..."></textarea>
                </div>

                <div id="upload-tab" class="tab-content">
                    <label for="file-input" class="file-label" id="file-label">NHẤN ĐỂ CHỌN FILE .DOCX</label>
                    <input type="file" id="file-input" accept=".docx">
                    <p id="file-name">Chưa chọn file nào.</p>
                </div>

                <div class="control-group">
                    <label for="voice-select">CHỌN GIỌNG ĐỌC:</label>
                    <select id="voice-select">
                        <option value="google-vi">Giọng Google</option>
                        <option value="banmai">Nữ miền Bắc - 1</option>
                        <option value="thuminh">Nữ miền Bắc - 2</option>
                        <option value="leminh">Nam miền Bắc </option>
                        <option value="myan">Nữ miền Nam - 1 </option>
                        <option value="lannhi">Nữ miền Nam - 2</option>
                        <option value="minhquang">Nam miền Nam </option>
                        <option value="ngoclam">Nữ miền Trung </option>
                        <option value="giahuy">Nam miền Nam </option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="speed-slider">TỐC ĐỘ: <span id="speed-value">1.0x</span></label>
                    <input type="range" id="speed-slider" min="0.5" max="1.5" value="1.0" step="0.1">
                </div>

                <button id="speak-btn">XỬ LÝ DỮ LIỆU</button>
                <p class="status" id="status-msg">Hệ thống sẵn sàng...</p>
                
                <audio id="audio-player" controls style="display: none;"></audio>
                <a id="download-btn" class="download-button" href="#" style="display: none;" download="speech.mp3">TẢI FILE VỀ MÁY</a>
            </div>
        </div>
    </div>

    <script>
        const splash = document.getElementById('splash-screen');
        const mainApp = document.getElementById('main-app');
        const startButton = document.getElementById('start-button');
        const mainLogo = document.getElementById('main-logo');
        const MY_SERVER_URL = '/api/tts'; 
        const textInput = document.getElementById('text-input');
        const voiceSelect = document.getElementById('voice-select');
        const speakBtn = document.getElementById('speak-btn');
        const statusMsg = document.getElementById('status-msg');
        const audioPlayer = document.getElementById('audio-player');
        const downloadBtn = document.getElementById('download-btn');
        const speedSlider = document.getElementById('speed-slider');
        const speedValue = document.getElementById('speed-value');
        const fileInput = document.getElementById('file-input');
        const fileNameDisplay = document.getElementById('file-name');
        const fileLabel = document.getElementById('file-label');
        let currentBlobUrl = null; 

        startButton.addEventListener('click', () => {
            splash.style.opacity = '0'; 
            setTimeout(() => { 
                splash.style.display = 'none'; 
                mainApp.style.display = 'flex'; 
                mainLogo.style.display = 'block'; 
            }, 800); 
        });

        window.openTab = function(evt, tabName) { 
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(btn => btn.className = btn.className.replace(" active", ""));
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        };

        speedSlider.addEventListener('input', () => {
            speedValue.textContent = parseFloat(speedSlider.value).toFixed(1) + 'x';
        });

        fileInput.addEventListener('change', (event) => {
            if (event.target.files.length === 0) return;
            const file = event.target.files[0];
            fileNameDisplay.textContent = file.name; 
            fileLabel.textContent = "ĐANG ĐỌC FILE...";
            
            const reader = new FileReader();
            reader.onload = (e) => {
                mammoth.extractRawText({ arrayBuffer: e.target.result })
                    .then(result => { 
                        textInput.value = result.value; 
                        fileLabel.textContent = "ĐÃ NHẬP DỮ LIỆU"; 
                    })
                    .catch(err => { console.error(err); fileLabel.textContent = "LỖI FILE"; });
            };
            reader.readAsArrayBuffer(file);
        });

        async function speakWithApi() {
            const text = textInput.value;
            if (!text) { statusMsg.textContent = "Vui lòng nhập nội dung!"; return; }

            speakBtn.disabled = true;
            statusMsg.textContent = "Đang kết nối máy chủ...";
            audioPlayer.style.display = "none";
            downloadBtn.style.display = "none";

            try {
                const response = await fetch(MY_SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        text: text, 
                        voice: voiceSelect.value, 
                        speed: speedSlider.value.toString() 
                    }) 
                });

                if (!response.ok) throw new Error("Lỗi kết nối server");

                const audioBlob = await response.blob();
                if (currentBlobUrl) URL.revokeObjectURL(currentBlobUrl);
                currentBlobUrl = URL.createObjectURL(audioBlob);

                audioPlayer.src = currentBlobUrl;
                audioPlayer.style.display = "block";
                audioPlayer.play();
                downloadBtn.href = currentBlobUrl; 
                downloadBtn.style.display = "block"; 
                statusMsg.textContent = "Xử lý thành công!";

            } catch (error) {
                statusMsg.textContent = "Lỗi: " + error.message;
            } finally {
                speakBtn.disabled = false;
            }
        }
        speakBtn.addEventListener('click', speakWithApi);
    </script>

</body>
</html>


